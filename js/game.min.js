function createCanvas(){const a=document.createElement("canvas");return a.width=window.innerWidth,a.height=window.innerHeight,a}function getContext(a){const b=a.getContext("2d");return b.imageSmoothingEnabled=!1,b}function Theme(a,b,c,d,e){this.NAME=a,this.COLOUR=b,this.BACKGROUND=c,this.TEXT=d,this.TEXTHIGHLIGHT=e,this.TEXTALT="#777777"}function setCycleStarts(){const a=Math.round(c.height/10),b=Math.round(c.width/(u.PLAYERCOUNT+1)),d=[];for(let e=0;e<u.PLAYERCOUNT;e+=1){let f=e%2===0?a:c.height-a-v,g=b*(e+1);d.push([g,f])}return d}function mod(a,b){return(a%b+b)%b}function fadeAudio(a,b){const c=setInterval(function(){try{a.volume-=.1,Math.abs(a.volume-b)<=.1&&clearInterval(c)}catch(b){a.volume=0,a.pause(),a.currentTime=0,clearInterval(c)}},100)}function startAudio(a,b){a.play();const c=setInterval(function(){try{a.volume+=.1}catch(b){a.volume=1,clearInterval(c)}},10)}function Cycle(a,b,c,d,e,f){this.id=a,this.x=b,this.y=c,this.colour=d,this.controls=e,this.boost=1,this.boostcharge=!0,this.speed=m,this.direction=f,this.directionPrev=f,this.orientation=f===J.LEFT||f===J.RIGHT?K.HORIZONTAL:K.VERTICAL,this.alive=!0,this.image=f===J.LEFT||f===J.RIGHT?za.images["cycle"+a+"h"]:za.images["cycle"+a+"v"],this.trail=za.images["trail"+a],this.turns=[[this.x+10,this.y+10]],this.setHitbox=function(a,b){this.hitboxX,this.hitboxY,this.hitboxLength=10,this.hitboxWidth=n,a===J.RIGHT?(this.hitboxX=this.x+10,this.hitboxY=this.y+10-2):a===J.LEFT?(this.hitboxX=this.x,this.hitboxY=this.y+10-2):a===J.UP?(this.hitboxX=this.x+10-2,this.hitboxY=this.y):a===J.DOWN&&(this.hitboxX=this.x+10-2,this.hitboxY=this.y+v-10)}}function Loader(a){function e(){b++,b===a.length&&ya(L.TITLE)}this.images={};let b=0;for(let c=0;c<a.length;c++){var d=new Image;d.src="img/"+a[c]+".png",d.onload=e,this.images[a[c]]=d}}const a=createCanvas(),b=getContext(a),c=createCanvas(),d=getContext(c),e=createCanvas(),f=getContext(e),g=document.body;g.appendChild(e),g.appendChild(c),g.appendChild(a);const h=13,i=27,j=79,k="Oswald-Regular",l=8,m=4,n=4;let o,p=!1;const q=5e3,r=new Theme("Black","#000000","url('img/bgTileBlack.png')","#FFFFFF","#FF0000"),s=new Theme("White","#FFFFFF","url('img/bgTileWhite.png')","#000000","#FF0000"),t=[r,s],u={PLAYERCOUNT:l,WINS:l,THEME:t[0],BOOST:!1,DISAPPEARINGTRAILS:!1},v=20,w=10,x=Math.abs(10)/2,y=["rgba(255,0,0,255)","rgba(0,0,255,255)","rgba(255,223,0,255)","rgba(0,255,0,255)","rgba(255,165,0,255)","rgba(0,255,255,255)","rgba(255,0,255,255)","rgba(119,119,119,255)"],z=[[87,65,83,68,69],[84,70,71,72,89],[73,74,75,76,79],[38,37,40,39,16],[49,50,51,52,53],[54,55,56,57,48],[90,88,67,86,66],[78,77,188,190,191]];let A=[0,0,0,0,0,0,0,0],B=0,C=!1,D=!0,E=!1,F=!1,G=0,H=!1,I=!1;const J={UP:0,LEFT:1,DOWN:2,RIGHT:3};Object.freeze(J);const K={HORIZONTAL:0,VERTICAL:1};Object.freeze(K);const L={TITLE:0,OPTION:1,GAME:2};Object.freeze(L);let M=document.getElementById("menuMusic"),N=document.getElementById("gameMusic");M.volume=1;const O=new Audio("snd/explosion2.mp3"),P=new Audio("snd/option.wav"),Q=new Audio("snd/option2.wav"),R=new Audio("snd/countdown.wav"),S=new Audio("snd/select.wav"),T=new Audio("snd/boost.wav"),U=new Audio("snd/winner.wav"),V=new Audio("snd/draw.wav"),W=new Audio("snd/champion.wav");O.volume=.2,P.volume=.6,Q.volume=.6;const X=function(a){d.fillStyle=a.boostcharge?"#FFFFFF":a.colour,a.orientation===K.HORIZONTAL?d.fillRect(a.hitboxX,a.hitboxY,a.hitboxLength,a.hitboxWidth):a.orientation===K.VERTICAL&&d.fillRect(a.hitboxX,a.hitboxY,a.hitboxWidth,a.hitboxLength)},Y=[],Z=function(){Y.length=0;const a=setCycleStarts();for(let b=0;b<u.PLAYERCOUNT;b+=1){let c=b%2===0?J.DOWN:J.UP;Y.push(new Cycle(b,a[b][0],a[b][1],y[b],z[b],c)),Y[b].setHitbox(c,K.VERTICAL)}},$={};addEventListener("keydown",function(a){$[a.keyCode]=!0},!1),addEventListener("keyup",function(a){delete $[a.keyCode]},!1);const _=function(a){const b=navigator.getGamepads()[a],c={Up:!1,Left:!1,Down:!1,Right:!1,Start:!1,Back:!1,A:!1,B:!1,none:function(){for(let a in this)if(this[a]===!0)return!1;return!0}};return b&&(c.Up=b.buttons[12].pressed||b.axes[1]<-.3,c.Left=b.buttons[14].pressed||b.axes[0]<-.3,c.Down=b.buttons[13].pressed||b.axes[1]>.3,c.Right=b.buttons[15].pressed||b.axes[0]>.3,c.Start=b.buttons[9].pressed,c.Back=b.buttons[8].pressed,c.A=b.buttons[0].pressed,c.B=b.buttons[1].pressed),c},aa=function(a){u.BOOST&&a.boostcharge&&(T.currentTime=0,T.play(),a.boost=2,a.boostcharge=!1,setTimeout(function(){a.boost=1},500),setTimeout(function(){a.boostcharge=!0},3e3))},ba=function(a){switch(a.orientation){case K.VERTICAL:d.clearRect(a.x+x,a.y,w,v);break;case K.HORIZONTAL:d.clearRect(a.x,a.y+x,v,w)}const b=a.controls,c=_(a.id);switch(b[J.UP]in $||c.Up===!0?a.direction!==J.DOWN&&(a.direction=J.UP,a.orientation=K.VERTICAL,a.image=za.images["cycle"+a.id+"v"]):b[J.LEFT]in $||c.Left===!0?a.direction!==J.RIGHT&&(a.direction=J.LEFT,a.orientation=K.HORIZONTAL,a.image=za.images["cycle"+a.id+"h"]):b[J.DOWN]in $||c.Down===!0?a.direction!==J.UP&&(a.direction=J.DOWN,a.orientation=K.VERTICAL,a.image=za.images["cycle"+a.id+"v"]):(b[J.RIGHT]in $||c.Right===!0)&&a.direction!==J.LEFT&&(a.direction=J.RIGHT,a.orientation=K.HORIZONTAL,a.image=za.images["cycle"+a.id+"h"]),(b[b.length-1]in $||c.A===!0)&&aa(a),a.setHitbox(a.direction,a.orientation),a.directionPrev!==a.direction&&(a.turns.push([a.x+10,a.y+10]),a.directionPrev=a.direction),a.direction){case J.UP:a.x=a.x,a.y=a.y-a.speed*a.boost,f.drawImage(a.trail,a.x+10-2,a.y+10,n,a.speed*a.boost);break;case J.LEFT:a.x=a.x-a.speed*a.boost,a.y=a.y,f.drawImage(a.trail,a.x+10,a.y+10-2,a.speed*a.boost,n);break;case J.DOWN:a.x=a.x,a.y=a.y+a.speed*a.boost,f.drawImage(a.trail,a.x+10-2,a.y+10-a.speed*a.boost,n,a.speed*a.boost);break;case J.RIGHT:a.x=a.x+a.speed*a.boost,a.y=a.y,f.drawImage(a.trail,a.x+10-a.speed*a.boost,a.y+10-2,a.speed*a.boost,n);break;default:a.x=a.x,a.y=a.y}},ca=function(a){let b;switch(a.orientation){case K.VERTICAL:(a.x<0||a.y<0||a.x+x+w>c.width||a.y+v>c.height)&&ea(a),b=a.direction===J.DOWN?f.getImageData(a.x+10-2,a.y+v,n,a.speed*a.boost).data:f.getImageData(a.x+10-2,a.y-1,n,a.speed*a.boost).data;break;case K.HORIZONTAL:(a.x<0||a.y<0||a.x+v>c.width||a.y+x+w>c.height)&&ea(a),b=a.direction===J.RIGHT?f.getImageData(a.x+v,a.y+10-2,a.speed*a.boost,n).data:f.getImageData(a.x-1,a.y+10-2,a.speed*a.boost,n).data}Y.forEach(function(b){if(b.id!==a.id&&b.alive===!0&&a.hitboxX<=b.hitboxX+b.hitboxWidth&&b.hitboxX<=a.hitboxX+a.hitboxWidth&&a.hitboxY<=b.hitboxY+b.hitboxLength&&b.hitboxY<=a.hitboxY+a.hitboxLength)return ea(a),void ea(b)});for(let d=0;d<b.length;d+=4)if(pixelcolour="rgba("+b[d]+","+b[d+1]+","+b[d+2]+","+b[d+3]+")","rgba(0,0,0,0)"!==pixelcolour)return void ea(a)},da=function(){let a=[];if(Y.forEach(function(b){b.alive===!0&&a.push(b)}),1===a.length){const b=a.pop();return A[b.id]+=1,A[b.id]===u.WINS?(W.currentTime=0,W.play(),qa(pa,b.id)):(U.currentTime=0,U.play(),qa(na,b.id)),void(D=!0)}if(0===a.length)return V.currentTime=0,V.play(),qa(oa,-1),void(D=!0)},ea=function(a){O.currentTime=0,O.play(),N.playbackRate+=.0625,a.alive=!1,ga(a),a.turns.push([a.x+10,a.y+10]),fa(a)},fa=function(a){const b=a.turns;for(let c=1;c<b.length;c+=1)b[c-1][0]!==b[c][0]?f.clearRect(Math.min(b[c-1][0],b[c][0]),b[c][1]-2,Math.abs(b[c-1][0]-b[c][0]),n):f.clearRect(b[c][0]-2,Math.min(b[c-1][1],b[c][1]),n,Math.abs(b[c-1][1]-b[c][1]))},ga=function(a){let b;a.orientation===K.VERTICAL?b=za.images["cycleDie"+a.id+"v"]:a.orientation===K.HORIZONTAL&&(b=za.images["cycleDie"+a.id+"h"]);let c=1;const e=setInterval(function(){switch(a.orientation){case K.VERTICAL:d.clearRect(a.x+x,a.y,w,v);break;case K.HORIZONTAL:d.clearRect(a.x,a.y+x,v,w)}d.drawImage(b,c%2*v,Math.floor(c/2)%3*v,v,v,a.x,a.y,v,v),c+=1,6===c&&clearInterval(e)},100)},ha=function(){p=!1,clearTimeout(o),o=setTimeout(function(){p=!0},q)},ia=function(a){const b=a.turns;f.fillStyle=u.THEME.TEXT,b.length>1?(f.fillStyle="grey",b[0][0]<b[1][0]?(f.clearRect(b[0][0],b[0][1]-2,a.speed*a.boost,n),a.turns[0][0]=b[0][0]+a.speed*a.boost,b[0][0]===b[1][0]&&b[0][1]===b[1][1]&&(b.shift(),f.clearRect(b[0][0],b[0][1]-2,a.speed*a.boost,n))):b[0][0]>b[1][0]?(f.clearRect(b[0][0]-a.speed*a.boost,b[0][1]-2,a.speed*a.boost,n),a.turns[0][0]=b[0][0]-a.speed*a.boost,b[0][0]===b[1][0]&&b[0][1]===b[1][1]&&(b.shift(),f.clearRect(b[0][0]-a.speed*a.boost,b[0][1]-2,a.speed*a.boost,n))):b[0][1]<b[1][1]?(a.turns[0][1]=b[0][1]+a.speed*a.boost,f.clearRect(b[0][0]-2,b[0][1]-a.speed*a.boost,n,a.speed*a.boost),b[0][0]===b[1][0]&&b[0][1]===b[1][1]&&(b.shift(),f.clearRect(b[0][0]-2,b[0][1]-a.speed*a.boost,n,a.speed*a.boost))):b[0][1]>b[1][1]&&(a.turns[0][1]=b[0][1]-a.speed*a.boost,f.clearRect(b[0][0]-2,b[0][1],n,a.speed*a.boost),b[0][0]===b[1][0]&&b[0][1]===b[1][1]&&(b.shift(),f.clearRect(b[0][0]-2,b[0][1],n,a.speed*a.boost)))):a.direction===J.RIGHT?(f.clearRect(b[0][0],b[0][1]-2,a.speed*a.boost,n),a.turns[0][0]=b[0][0]+a.speed*a.boost):a.direction===J.LEFT?(f.clearRect(b[0][0]-a.speed*a.boost,b[0][1]-2,a.speed*a.boost,n),a.turns[0][0]=b[0][0]-a.speed*a.boost):a.direction===J.UP?(f.clearRect(b[0][0]-2,b[0][1]-a.speed*a.boost,n,a.speed*a.boost),a.turns[0][1]=b[0][1]-a.speed*a.boost):a.direction===J.DOWN&&(f.clearRect(b[0][0]-2,b[0][1],n,a.speed*a.boost),a.turns[0][1]=b[0][1]+a.speed*a.boost)},ja=function(){Y.forEach(function(a){a.alive===!0&&ba(a)}),Y.forEach(function(a){a.alive===!0&&ca(a)}),p&&Y.forEach(function(a){a.alive===!0&&ia(a)}),da()};let ka=function(){Y.forEach(function(a){a.alive===!0&&(d.drawImage(a.image,a.x,a.y),u.BOOST&&X(a))}),b.clearRect(0,0,50,a.height),b.font="24px "+k,b.textAlign="left",b.textBaseline="top",Y.forEach(function(a){b.fillStyle=a.colour,b.fillText(A[a.id],10,10+30*a.id)})};const la="Ready?",ma=["3","2","1"],na="Round Winner!",oa="Draw!",pa="Champ!",qa=function(c,d,e){F=!0,e&&(H=!0),N.playbackRate=1,d!==-1?(b.strokeStyle=Y[d].colour,G=d):(b.strokeStyle=u.THEME.TEXT,G=0),b.fillStyle=u.THEME.COLOUR,b.lineWidth=8,b.fillRect(a.width/2-120,a.height/2-50,240,100),b.strokeRect(a.width/2-120,a.height/2-50,240,100),b.font="30px "+k,b.textAlign="center",b.textBaseline="middle",b.fillStyle=u.THEME.TEXT,b.fillText(c,a.width/2,a.height/2)},ra=function(c){E=!0;let d=0;timeoutFunction=function(){b.clearRect(a.width/2-130,a.height/2-60,260,120),b.textAlign="center",b.textBaseline="middle",b.fillStyle=u.THEME.TEXT,d!==c.length?(R.currentTime=0,R.play(),b.font=24*(d+3)+"px "+k,b.fillText(c[d],a.width/2,a.height/2)):(E=!1,startAudio(N),clearInterval(e),b.clearRect(0,0,a.width,a.height),u.DISAPPEARINGTRAILS&&ha()),d+=1},timeoutFunction();const e=setInterval(timeoutFunction,1e3)},sa=function(){const c=za.images.pauseOverlay;b.globalAlpha=.7,b.drawImage(c,0,0,a.width,a.height),b.globalAlpha=1,b.fillStyle="#FFFFFF",b.font="24px "+k,b.textAlign="center",b.textBaseline="middle",b.fillText("Press Back or [O] to return to Options",a.width/2,a.height/2)},ta=function(){b.clearRect(0,0,a.width,a.height)},ua=function(c){const d=za.images.logo2;b.drawImage(d,a.width/2-d.width/2,a.height/2-d.height/2);const e=_(0);return I||(h in $||e.A===!0||e.Start===!0)&&(S.currentTime=0,S.play(),I=!0,b.clearRect(0,0,a.width,a.height),c=L.OPTION),c},va=function(c){1===N.volume&&fadeAudio(N),0===M.volume&&startAudio(M),M.currentTime>=208&&(M.currentTime=7.25),b.clearRect(0,0,a.width,a.height),b.font="24px "+k,b.textAlign="center",b.textBaseline="top",b.fillStyle=u.THEME.TEXTALT,b.fillText("Press A or [Enter] to Start",a.width/2,a.height/2-105),b.fillStyle=u.THEME.TEXT;const d=["Players: "+u.PLAYERCOUNT,"Wins: "+u.WINS,"Theme: "+u.THEME.NAME,"Boost: "+(u.BOOST?"Yes":"No"),"Disappearing Trails: "+(u.DISAPPEARINGTRAILS?"Yes":"No")];for(let e=0;e<d.length;e+=1)b.fillStyle=e===B?u.THEME.TEXTHIGHLIGHT:u.THEME.TEXT,b.fillText(d[e],a.width/2,a.height/2-30*(d.length/2-e));const f=_(0);if(I)0===Object.keys($).length&&f.none()&&(I=!1);else if(I=!0,h in $||f.A===!0||f.Start===!0)b.clearRect(0,0,a.width,a.height),c=L.GAME,S.currentTime=0,S.play();else if(z[0][0]in $||f.Up===!0)console.log(navigator.getGamepads()),B=mod(B-1,Object.keys(u).length),P.currentTime=0,P.play();else if(z[0][2]in $||f.Down===!0)console.log(navigator.getGamepads()),B=mod(B+1,Object.keys(u).length),P.currentTime=0,P.play();else if(z[0][1]in $||f.Left===!0||z[0][3]in $||f.Right===!0){const a=z[0][1]in $||f.Left===!0,b=Object.keys(u)[B],c=typeof u[b];switch(c){case"number":u[b]=a===!0?u[b]-1:u[b]+1,u[b]>l?u[b]=l:u[b]<2&&(u[b]=2);break;case"boolean":u[b]=!u[b],u[b]&&"BOOST"===b?u.DISAPPEARINGTRAILS=!1:u[b]&&"DISAPPEARINGTRAILS"===b&&(u.BOOST=!1);break;case"object":u[b]instanceof Theme&&(u[b]=t[mod(t.indexOf(u.THEME)+1,t.length)],document.body.style.background=u.THEME.BACKGROUND)}Q.currentTime=0,Q.play()}else f.B===!0?window.location.reload():I=!1;return c},wa=function(a){1===M.volume&&fadeAudio(M),N.currentTime>=161&&(N.currentTime=7.3);const b=_(0);if(I||E||F)if(F){I=!0;const a=_(G);h in $||a.A===!0||a.Start===!0?(F=!1,H&&(I=!1,H=!1,ra(ma))):I=!1}else 0===Object.keys($).length&&b.none()&&(I=!1);else{if(I=!0,h in $||i in $||b.Start===!0)C=!C,C===!0?sa():ta();else{if(1==C&&(j in $||b.Back===!0))return ta(),C=!1,D=!0,A=A.map(function(a){return a=0}),a=L.OPTION;I=!1}C||(D&&(A.includes(u.WINS)&&(A=A.map(function(a){return a=0})),qa(la,-1,!0),f.clearRect(0,0,e.width,e.height),d.clearRect(0,0,c.width,c.height),Z(),D=!1),ja(),ka())}return a},xa=function(){const a=[];for(let b=0;b<l;b++)a.push("cycle"+b+"h"),a.push("cycle"+b+"v"),a.push("cycleDie"+b+"h"),a.push("cycleDie"+b+"v"),a.push("trail"+b);return a.push("logo2"),a.push("bgTileBlack"),a.push("bgTileWhite"),a.push("pauseOverlay"),a},ya=function(a){switch(a){case L.TITLE:a=ua(a);break;case L.OPTION:a=va(a);break;case L.GAME:a=wa(a)}requestAnimationFrame(function(){ya(a)})},za=new Loader(xa());